(()=>{function r(i){return i?new Function(`return {${i}}`)():null}function a(i,t){for(let e in i)if(i.hasOwnProperty(e)){if(typeof i[e]=="object"&&i[e]!==null&&t[e]){if(!a(i[e],t[e]))return!1}else if(i[e]!==t[e])return!1}return!0}function l(i,t,...e){if(!i)return;let n=window,s=i.split(".");for(let o of s)if(n=n&&n[o],n instanceof Function)return n.bind(t)(...e)}class h{constructor(t){if(this.el=t,this.form=t instanceof HTMLFormElement?t:t.form,!this.form)throw new Error("Element is not a form or does not have a form ancestor.");this._lastCalled=0,this._interval=+(t.dataset.debounce||0),this._match=r(t.dataset.match),this._notMatch=r(t.dataset.matchNot);let e=t.dataset.targetEl;e&&(this.targetEl=document.querySelector(e)),t.hasAttribute("data-onload")&&this.form.requestSubmit();let n=t.dataset.event;n&&(this.el??document).addEventListener(n,this)}handleEvent(t){if(t&&(this._match&&!a(this._match,t)||this._notMatch&&a(this._notMatch,t)))return;let e=this._interval;if(e&&this._lastCalled+e>Date.now()){this._lastCalled=Date.now(),this._id&&clearTimeout(this._id),this._id=setTimeout(()=>this.handleEvent(t),e);return}this._lastCalled=Date.now();let n=this.el.dataset.call,s=this.el.dataset.action;n?l(n,this,t):s?(this._action||(this._action=new Function("event",s).bind(this)),this._action(t)):this.form.requestSubmit()}}window.defineTrait?.("x-subscribe",h);})();
