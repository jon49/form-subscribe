(()=>{function a(i){return i?new Function(`return {${i}}`)():null}function r(i,t){for(let e in i)if(i.hasOwnProperty(e)){if(typeof i[e]=="object"&&i[e]!==null&&t[e]){if(!r(i[e],t[e]))return!1}else if(i[e]!==t[e])return!1}return!0}function l(i,t,...e){if(!i)return;let n=window,s=i.split(".");for(let o of s)if(n=n&&n[o],n instanceof Function)return n.bind(t)(...e)}class c{constructor(t){this.el=t,this.form=t instanceof HTMLFormElement?t:t.form,this.form&&(this.submitter=t instanceof HTMLFormElement?null:t instanceof HTMLButtonElement?t:t.closest('[type="submit"]')),this._lastCalled=0,this._interval=+(t.dataset.debounce||0),this._match=a(t.dataset.match),this._notMatch=a(t.dataset.matchNot);let e=t.dataset.targetEl;e&&(this.targetEl=document.querySelector(e)),t.hasAttribute("data-onload")&&(this.form?.requestSubmit(this.submitter),this.runAction());let n=t.dataset.event;n&&(this.targetEl??document).addEventListener(n,this)}handleEvent(t){if(t&&(this._match&&!r(this._match,t)||this._notMatch&&r(this._notMatch,t)))return;let e=this._interval;if(e&&this._lastCalled+e>Date.now()){this._lastCalled=Date.now(),this._id&&clearTimeout(this._id),this._id=setTimeout(()=>this.handleEvent(t),e);return}this._lastCalled=Date.now();let n=this.el.dataset.call,s=this.el.dataset.action;n?l(n,this,t):s?this.runAction(t):this.form?.requestSubmit(this.submitter)}runAction(t){if(!this._action){let e=this.el.dataset.action;if(!e)return;this._action=new Function("event","$","$$",e).bind(this.el)}this._action(t,e=>document.querySelector(e),e=>document.querySelectorAll(e))}}window.defineTrait?.("x-on",c);})();
